<div class="content section-padding bg-white box-shadow section-bottom-spacing">

  <div class="section-heading section-head-with-button">
    <div class="section-title">
      <p>
        <img src="../../../../assets/img/svg/Icon-feather-star.svg" class="start-icon" />
        {{ isEventExploreFlow ?  'Explore Events List' : 'Highlighted Events List' }}
      </p>
    </div>
    <div>
      <button class="btn btn-primary btn-raised" routerLink='/event'>
        <!-- <img src="../../../../assets/img/svg/left-arrow.svg" style="width: 15px; margin-right: 10px;"/>
        Back -->
        <i class="fa fa-long-arrow-left" aria-hidden="true">
          <span class="ml-1">Back</span></i>
      </button>
    </div>
  </div>

  <div *ngIf="hightlightedEventsList" class="tabular-data-wrapper">
    <!-- <div class="row">
        <div class="col-md-4 mb-2">
          <form [formGroup]="searchUserForm" (submit)="searchUser()">
            <input class="form-control" type="text" placeholder="Search by Name, Mobile, Email" formControlName="search">
          </form>
        </div>
      </div> -->
    <p-table #dt [columns]="cols" [value]="hightlightedEventsList" [responsive]="true" styleClass="faq-table"
      [alwaysShowPaginator]="false">
      <ng-template pTemplate="caption">
        <div class="row">
          <div class="col-md-9">
            <div class="row">
              <div class="col-md-6 mb-2 pl-0 text-left" style="text-align: right">
                <input type="text" pInputText size="46" placeholder="Event Search..." [(ngModel)]="searchValue"
                  class="form-control mb-2" style="width: auto;">
              </div>
              <!--............multilevel dropdown...........  -->

              <div class="dropdown col-md-6 pl-0" style="position: relative;">
                <button class="btn dropdown dropdown-toggle drop-button" type="button" data-toggle="dropdown">
                  {{categoryTitle}}
                  <span class="caret"></span>
                </button>
                <ul class="dropdown-menu menu-transition">
                  <li style="display: flex;" (click)="selectAllCategories($event)">
                    <a class="dropdown-item" href="javaScript:void(0)" [ngClass]="{'active': allCategoriesSelect}">
                      <input type="checkbox" [checked]="allCategoriesSelect" class="space" />
                      All Categories
                    </a>
                  </li>
                  <li style="display: flex;" *ngFor="let category of categorySubCategoryList"
                    (click)="categorySelect($event, category)">
                    <a class="dropdown-item"
                      [ngClass]="{'dropdown-toggle': category?.subCategory.length > 0, 'active': Object.keys(selectedCategory).includes(category.id.toString()) && selectedCategory[category.id]?.allChecked}"
                      href="javaScript:void(0)">
                      <input type="checkbox"
                        [checked]="Object.keys(selectedCategory).includes(category.id.toString()) && selectedCategory[category.id]?.allChecked"
                        [indeterminate]="selectedCategory[category.id]?.partialChecked" class="space" />
                      {{category.categoryName}}
                    </a>
                    <ul class="submenu dropdown-menu" *ngIf="category?.subCategory.length > 0">
                      <li style="display: flex;" *ngFor="let subcategory of category?.subCategory"
                        (click)="subCategorySelect($event, subcategory, category)">
                        <a [ngClass]="{'active': selectedCategory[category.id]?.subcategorySelect.includes(subcategory.id)}"
                          class="dropdown-item" href="javaScript:void(0)">
                          <input type="checkbox"
                            [checked]="selectedCategory[category.id]?.subcategorySelect.includes(subcategory.id)"
                            class="space" />
                          {{subcategory.subCategoryName}}</a>
                      </li>
                    </ul>
                  </li>
                </ul>
              </div>
            </div>
          </div>

          <div class="col-md-3 mb-2 pr-0  text-left">
            <!-- <select class="form-control" (change)="filterByStatus($event.target.value)">
              <option value="1">Paid Event</option>
              <option value="0">Free Event</option>
              <option value="2">System Tickets</option>
            </select> -->
            <p-dropdown [style]="{float:'right',width:'100%'}" [options]="sortByArray" [(ngModel)]="selectedSortBy"
              optionLabel="name" ></p-dropdown>
            <!-- <p-dropdown [options]="sortByArray" [(ngModel)]="selectedSortBy" optionLabel="name"  placeholder='Sort By'></p-dropdown> -->
          </div>

        </div>
        <form [formGroup]="searchByDateForm" class="event-list-form" (submit)="searchByDate()">
          <div class="row">
            <div class="col-md-2 mb-2 text-left pl-0">
              <p-calendar dateFormat="dd-mm-yy" placeholder="From Date" formControlName="toDate"
                (onSelect)="onToDateChange($event)" [style]="{'width':'324px'}"></p-calendar>
            </div>
            <div class="col-md-2 mb-2 text-left">
              <p-calendar dateFormat="dd-mm-yy" placeholder="To Date" formControlName="fromDate" [minDate]="minFromDate"
                dateFormat="dd-mm-yy" [style]="{'width':'324px'}"></p-calendar>
            </div>
            <div class="col-md-3 mb-2 pl-1">
              <button class="btn btn-primary btn-raised">Search</button>
              &nbsp;&nbsp;
              <button class="btn btn-danger btn-raised" type="button" (click)="resetSearchForm()">Reset</button>
            </div>
          </div>
        </form>
      </ng-template>

      <ng-template pTemplate="header">
        <tr>
          <th style="width: 5%;">Sr.No.</th>
          <th>Name</th>
          <th>Start</th>
          <th>End</th>
          <th>Type</th>
          <th>Category</th>
          <th>Sub-Category</th>
          <th>Users Attending</th>
          <th>Total Tickets</th>
          <th>Avg Price</th>
          <th>Status</th>
          <th style="width: 10%;" *ngIf="!isEventExploreFlow">Priority</th>
          <th style="width: 10%;">View</th>
        </tr>
      </ng-template>
      <ng-template pTemplate="body" let-item let-key let-i="rowIndex">
        <tr>
          <td>{{ i + 1 }}</td>
          <!-- <td><span *ngFor="let col of columns" [ngSwitch]="col.field" class="ui-column-title">
            <input [ngSwitch]="col.field" *ngSwitchCase="name" pInputText type="text"
              (input)="dt.filter($event.target.value, col.field, 'contains')">
            Name</span>{{item?.name}}</td> -->
          <td><span class="ui-column-title">Name</span>{{item.name ? item.name : 'N/A'}}</td>
          <td><span class="ui-column-title">Start</span>{{item?.start | date: 'MMMM d, y'}}</td>
          <td><span class="ui-column-title">End</span>{{item?.end | date: 'MMMM d, y'}}</td>
          <td><span class="ui-column-title">Type</span>{{item?.eventType == 1 ? 'Paid' : '' || item?.eventType == 0 ?
            'Free' : '' || item?.eventType == 2 ? 'System Tickets' : ''}}</td>
          <td><span class="ui-column-title">Category</span>{{item?.eventCategories | categories}}</td>
          <td><span class="ui-column-title">Sub-Category</span>{{item?.eventSubCategories | subcategories}}</td>
          <td><span class="ui-column-title">Users Attending</span>{{item?.attendeescount == null ? 0 :
            item?.attendeescount}}/{{item?.actualquantity}}</td>
          <td><span class="ui-column-title">Total Tickets</span>{{item?.actualquantity ? item?.actualquantity : 0}}</td>
          <td><span class="ui-column-title">Avg Price</span>${{item?.ticket_info[0]?.averageprice ?
            item?.ticket_info[0]?.averageprice : 0}}</td>
          <!-- <td><span class="ui-column-title">Discount</span></td> -->

          <td *ngIf="!isEventExploreFlow"><span class="ui-column-title">Status</span>

            <div class="d-flex align-items-center" (click)="confirmMarkHighlight(i, item.id, item.isHighLighted)"
              style="cursor: pointer;">
              <ng-container *ngIf="!item?.isHighLighted">
                <svg xmlns="http://www.w3.org/2000/svg" width="33" height="31.529" viewBox="0 0 33 31.529">
                  <path id="Icon_feather-star" data-name="Icon feather-star"
                    d="M18,3l4.635,9.39L33,13.9l-7.5,7.3,1.77,10.32L18,26.655,8.73,31.53,10.5,21.21,3,13.9,13.365,12.39Z"
                    transform="translate(-1.5 -1.5)" fill="#fff" stroke="#f2ca4e" stroke-linecap="round"
                    stroke-linejoin="round" stroke-width="3" />
                </svg>
              </ng-container>

              <ng-container *ngIf="item?.isHighLighted">
                <svg xmlns="http://www.w3.org/2000/svg" width="33" height="31.529" viewBox="0 0 33 31.529">
                  <path id="Icon_feather-star" data-name="Icon feather-star"
                    d="M18,3l4.635,9.39L33,13.9l-7.5,7.3,1.77,10.32L18,26.655,8.73,31.53,10.5,21.21,3,13.9,13.365,12.39Z"
                    transform="translate(-1.5 -1.5)" fill="#f2ca4e" stroke="#f2ca4e" stroke-linecap="round"
                    stroke-linejoin="round" stroke-width="3" />
                </svg>
              </ng-container>
              <!-- <app-active-swtich [checked]="item?.is_active" (change)="statusChange($event, item.id)" class="ml-1">
              </app-active-swtich> -->
            </div>

          </td>

          <td *ngIf="isEventExploreFlow"><span class="ui-column-title">Status</span>

            <div class="d-flex align-items-center" (click)="confirmMarkExplored(i, item.id, item.isExploreEvent)"
              style="cursor: pointer;">
              <ng-container *ngIf="!item?.isExploreEvent">
                <svg xmlns="http://www.w3.org/2000/svg" width="33" height="31.529" viewBox="0 0 33 31.529">
                  <path id="Icon_feather-star" data-name="Icon feather-star"
                    d="M18,3l4.635,9.39L33,13.9l-7.5,7.3,1.77,10.32L18,26.655,8.73,31.53,10.5,21.21,3,13.9,13.365,12.39Z"
                    transform="translate(-1.5 -1.5)" fill="#fff" stroke="#f2ca4e" stroke-linecap="round"
                    stroke-linejoin="round" stroke-width="3" />
                </svg>
              </ng-container>

              <ng-container *ngIf="item?.isExploreEvent">
                <svg xmlns="http://www.w3.org/2000/svg" width="33" height="31.529" viewBox="0 0 33 31.529">
                  <path id="Icon_feather-star" data-name="Icon feather-star"
                    d="M18,3l4.635,9.39L33,13.9l-7.5,7.3,1.77,10.32L18,26.655,8.73,31.53,10.5,21.21,3,13.9,13.365,12.39Z"
                    transform="translate(-1.5 -1.5)" fill="#f2ca4e" stroke="#f2ca4e" stroke-linecap="round"
                    stroke-linejoin="round" stroke-width="3" />
                </svg>
              </ng-container>
              <!-- <app-active-swtich [checked]="item?.is_active" (change)="statusChange($event, item.id)" class="ml-1">
              </app-active-swtich> -->
            </div>

          </td>

          <td *ngIf="!isEventExploreFlow"><span class="ui-column-title">Priority</span>
            <div class="dropdown col-md-12 p-0" *ngIf="item.isHighLighted">
              <button class="btn dropdown dropdown-toggle wid-80 drop-button" type="button" data-toggle="dropdown">
                {{item.priority ? item.priority : 'None' | titlecase}}
                <span class="caret"></span>
              </button>
              <ul class="dropdown-menu menu-width">
                <li style="display: flex;" *ngFor="let priority of priorityList"
                  (click)="onChangePriority(priority, i)">
                  <a class="dropdown-item" href="javaScript:void(0)">
                    {{priority.name}}
                  </a>
                </li>
              </ul>
            </div>
            <div class="dropdown col-md-12" *ngIf="!item.isHighLighted">-</div>
          </td>

          <td class="action-buttons">
            <span class="ui-column-title">View</span>
            <button (click)="goToEventDetail(item.id)" class="custom-btn custom-btn-small blue-btn text-center edit"
              style=" margin-right: 4px !important;min-width: 4em !important;height: 2.4em !important; color:#ce0017">
              <i class="fa fa-eye" aria-hidden="true"></i></button>
          </td>
        </tr>
      </ng-template>
      <ng-template pTemplate="emptymessage">
        <tr>
          <td class="text-center text-danger" colspan="12">No Record Found.</td>
        </tr>
      </ng-template>
    </p-table>
    <p-paginator [rows]="10" [totalRecords]="totalRecords" (onPageChange)="paginate($event)"></p-paginator>
  </div>

</div>
<p-confirmDialog [style]="{width: '50vw'}" autoZIndex='true' appendTo="body"></p-confirmDialog>